<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		
		<link href="js/themes/dark-hive/jquery-ui.css" rel="stylesheet">
		<link href="js/themes/dark-hive/theme.css" rel="stylesheet">

		<script type="text/javascript" src="js/jquery-3.7.1.min.js"></script>
		<script type="text/javascript" src="js/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="js/jquery-ui.js"></script>
		<script type="text/javascript" src="js/libsndfile.js"></script>
		<script type="text/javascript" src="config/controller.bundle.js"></script>

		<title>WebGPU Test Page</title><link rel="shortcut icon" href="data:image/png;base64, AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbbv+DGW3/mRlt/5kZbf+ZGq6/hIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGa3/ohkt/7/Zbj//2S3/v9lt/6WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGm5/iRlt/74Zbj//2W4//9luP//Zbf++mi4/i4gIPciGhr24hsb9uwbG/bsGhr24CEh9xoAAAAAAAAAAAAAAABnuP5mZLf+/2W4//9luP//Zbj//2S3/v9muP5yGBj2rhMT9v8TE/b/ExP2/xMT9f8YGPWkAAAAAAAAAAAAAAAAb7z/BGW3/tZluP//Zbj//2W4//9lt/7gJzH3ShMT9f8TE/b/ExP2/xMT9v8TE/b/ExP1/CAg9joAAAAAAAAAAAAAAABmuP5GZLf+6GS3/uhkt/7oZbf+UhgY9YQSEvX/ExP2/xMT9v8TE/b/ExP2/xIS9f8aGvZ8AAAAAD4++gQgIPZ6IiL2hiIi9oYgIPZ8KCj5BAAAAAAtLfgUFBT17BMT9v8TE/b/ExP2/xMT9v8VFfXoLCz4DgAAAAAaGvZqEhL1/xMT9v8TE/b/EhL1/xsb9nIAAAAAAAAAABwc9m4SEvX/ExP2/xMT9v8SEvX/HR32ZAAAAAAnJ/gSFRX16hMT9v8TE/b/ExP2/xMT9v8UFPXuJyf4Fp2xlAKNnqUYLC/mfhYW83ATE/VuFxf1aDc3+gIAAAAAGBj1fhIS9f8TE/b/ExP2/xMT9v8TE/b/ExP1/xkZ9YaGn3yIhZ57/4Wee/+Gn3yKAAAAAAAAAAAAAAAAAAAAACMj9zYTE/X8ExP2/xMT9v8TE/b/ExP2/xMT9f9JUshihZ57+IaffP+Gn3z/hZ579oigfiYAAAAAAAAAAAAAAAAAAAAAGBj1oBIS9f8TE/b/ExP2/xMT9f8YGPWmiKB+PIWee/+Gn3z/hp98/4Wee/+HoH06AAAAAAAAAAAAAAAAAAAAACUl9xgVFfXOExP11BMT9dQUFPXQJib3HgAAAACGn3ymhp98/4affP+Gn3ymAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiKB+EIihf0CIoX9AiKB+EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADg/wAA4MMAAOCBAADggQAA8QEAAOeBAADDwwAAgf8AAIAPAACBDwAAgQ8AAMMPAAD//wAA//8AAA==" type="image/png">
		<style>
			@font-face {
	            font-family: 'Segoe UI Light';
        	    src: url( font/segoeuil.ttf ) format( 'truetype' );
	        }
			body{
				font-family: 'Segoe UI Light';
				margin-top: 3em;
				margin-bottom: 3em;
				margin-left: auto;
				margin-right: auto;
				width: 80%;
			}
			#gfx {
		    	width: 100%;
	            display: none;
			}
			#controlgroup {
		    	width: 100%;
	            display: none;
			}
			#error {
        	    text-align: center;
	            width: 100%;
        	    color: red;
        	    display: block;
			}
			.ui-input {
				padding: .4em .4em;
				display: inline-block;
				position: relative;
				line-height: normal;
				margin-right: .1em;
				cursor: pointer;
				vertical-align: middle;
				text-align: left;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;

				/* Support: IE <= 11 */
				overflow: visible;
			}
			.ui-input,
			.ui-input:link,
			.ui-input:visited,
			.ui-input:hover,
			.ui-input:active {
				text-decoration: none;
			}

		</style>

		<script type='text/javascript'>

			(function($)
			{
				$.fn.input = function (css)
				{
					if (!css) css = {};
					return this.each(function ()
					{
						$(this).addClass("ui-widget ui-widget-content ui-corner-all ui-input");
						$(this).css(css);
					});
				}
			})(jQuery);

			(function ($)
			{
				$.fn.label = function (css)
				{
					if (!css) css = {};
					return this.each(function ()
					{
						$(this).addClass("ui-widget ui-input");
						$(this).css(css);
					});
				}
			})(jQuery);

			window["isNumber"] = function(n) { return /^-?[\d.]+(?:e-?\d+)?$/.test(n); }
			window["startplayback"] = function( file_name ) {
					// var fileinput = document.getElementById('fileinput');

					// if (fileinput.files.length == 0) {
					//	filename.innerHTML = "";
					//	return;
					// }

					// var file = fileinput.files[0];

					Module.ccall(
						'AL_init',
						null,
						null,
						null
					);

					let retval = Module.ccall(
						'AL_play',
						'number',
						['string'],
						[ file_name ]
					);
			};
			window["stopplayback"] = function() {
					let retval = Module.ccall(
						'AL_stop',
						'number',
						null,
						null
					);

					Module.ccall(
						'AL_exit',
						null,
						null,
						null
					);
			};


			jQuery(document).ready(function () 
			{			
				let change_samplerate = function() {
					let value = $( "#sample-rate" ).spinner( "value" );
					value = window.isNumber( value ) ? value : 44100;
					$( "#sample-rate" ).spinner( "value", value );
					window.samplerate = parseFloat( value );					
				};

				let change_volumerate = function() {
					let value = $("#volume-rate").spinner( "value" );
					value = window.isNumber( value ) ? value : 1.000;
					$("#volume-rate").spinner( "value", value );
					window.volumerate = parseFloat( value );					
				};

				$( "#sample-rate" ).spinner( {
					create: function( event, ui ) {
						$( "#sample-rate" ).spinner( "value", 44100 );
						window.samplerate = 44100;
					},
					change: function( event, ui ) {
						change_samplerate();
					},
//					spin: function( event, ui ) {
//						window.samplerate = ui.value;
//					},
					min: 2000,
					max: 96000,
					step: 100,
					value: 44100,
				});

				$( "#sample-rate" ).click(function() {
					change_samplerate();
				});

			    $( "#sample-rate" ).keyup(function(){
					if (event.keyCode === 13) {
						change_samplerate();
					}
    			});

				$( "#volume-rate" ).spinner({
					create: function( event, ui ) {
						$("#volume-rate").spinner( "value", 1.000 );
						window.volumerate = 1.000;
					},
					change: function( event, ui ) {
						change_volumerate();
					},					
//					spin: function( event, ui ) {
//						window.volumerate = ui.value;
//					},
					min: 0.000,
					max: 1.000,
					step: 0.001,
					value: 1.0,
				});

				$( "#volume-rate" ).click( function() {
					change_volumerate();
				});

			    $( "#volume-rate" ).keyup( function(){
					if (event.keyCode === 13) {
						change_volumerate();
					}
    			});

				$( "#zoom-x" ).slider({
					create: function( event, ui ) {
						$("#zoom-x").slider( "value", 100 );
						window.zoomX = 100;
					},
					change: function( event, ui ) {
						$("#zoom-x-value").text( ui.value );
						window.zoomX = ui.value;
					},					
					slide: function( event, ui ) {
						$("#zoom-x-value").text( ui.value );
					},
					range: false,
					min: 100,
					max: 400,
					step: 1
				});
				$( "#minimum-x" ).slider({
					create: function( event, ui ) {
						$("#minimum-x").slider( "value", 30 );
						window.kdX = 30;
					},
					change: function( event, ui ) {
						$("#minimum-x-value").text( ui.value );
						window.kdX = ui.value;
					},
					slide: function( event, ui ) {
						$("#minimum-x-value").text( ui.value );
					},					
					range: false,
					min: 6,
					max: 999,
					step: 2,
				});
				$( "#zoom-y" ).slider({
					create: function( event, ui ) {
						$("#zoom-y").slider( "value", 80 );
						window.zoomY = 80;
					},
					change: function( event, ui ) {
						$("#zoom-y-value").text( ui.value );
						window.zoomY = ui.value;
					},
					slide: function( event, ui ) {
						$("#zoom-y-value").text( ui.value );
					},					
					range: false,
					min: 80,
					max: 400,
					step: 1
				});
				$( "#minimum-y" ).slider({
					create: function( event, ui ) {
						$("#minimum-y").slider( "value", 10 );
						window.kdY = 10;
					},
					change: function( event, ui ) {
						$("#minimum-y-value").text( ui.value );
						window.kdY = ui.value;
					},
					slide: function( event, ui ) {
						$("#minimum-y-value").text( ui.value );
					},							
					min: 3,
					max: 559,
					step: 2,
				});
				$( "#controlgroup" ).controlgroup();

				Module.onRuntimeInitialized = () => { 
					window.startplayback( "file:///D:/noise-2.mp3" );
					window.startapp();
				}

			});
		</script>
	</head>

	<body>	
		<div id="error">[ Your browser does not support WebGPU or it is not enabled ]</div>
		<div id="controlgroup">
			<label for="sample-rate">Частота дискретизации:</label>
			<div><input style="width:150px;" id="sample-rate"/></div>
			<br />
			<label for="volume-rate">Ось Y:</label>
			<div><input style="width:60px;" id="volume-rate"/></div>
			<br />
			<label for="zoom-x">Масштаб по x:&nbsp;<span id="zoom-x-value">0</span></label>
			<div style="width:450px;" id="zoom-x"></div>
			<br />
			<label for="minimum-x">Дискретное пространство по x:&nbsp;<span id="minimum-x-value">0</span></label>
			<div style="width:450px;" id="minimum-x"></div>
			<br/>
			<label for="zoom-y">Масштаб по y:&nbsp;<span id="zoom-y-value">0</span></label>
			<div style="width:450px;" id="zoom-y"></div>
			<br />
			<label for="minimum-y">Дискретное пространство по y:&nbsp;<span id="minimum-y-value">0</span></label>
			<div style="width:450px;" id="minimum-y"></div>
			<br />
			<br />
		</div>
		<canvas id="gfx">&nbsp;</canvas>
	</body>
</html>
